<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>
		<title>oop</title>
		<link rel="stylesheet" type="text/css" href="css/stylesheet.css" />
		<script type="text/javascript" src="scripts/jsface.js"></script>
		<script type="text/javascript" src="scripts/jgen.math.js"></script>
		<script type="text/javascript" src="scripts/jgen.html.js"></script>
		<script type="text/javascript" src="scripts/jgen.string.js"></script>
		<script type="text/javascript" src="scripts/jgen.event.js"></script>
		<script type="text/javascript" src="scripts/jgen.selector.js"></script>
		<script type="text/javascript" src="scripts/jgen.sprite.js"></script>
		<script type="text/javascript">
			window.addEventListener('load', function() {
				
				var thissound= document.getElementById('sound1');
				var oSprite = new jgen.sprite(document.body, 'media/sprite.png', 64, 64);
				oSprite.setVisible(true);
				
				// when creating a sprite there must be a way to set base angle on it
				// so it's not necessary to change the sprite itself to achieve right rotation
				
				var oExplosion = new jgen.sprite(document.body, 'media/explosion.png', 64, 64);
				oExplosion.addFrame(0, 0);
				oExplosion.addFrame(64, 0);
				oExplosion.addFrame(128, 0);
				oExplosion.addFrame(192, 0);
				oExplosion.addFrame(0, 64);
				oExplosion.addFrame(64, 64);
				oExplosion.addFrame(128, 64);
				oExplosion.addFrame(192, 64);
				oExplosion.addFrame(0, 128);
				oExplosion.addFrame(64, 128);
				oExplosion.addFrame(128, 128);
				oExplosion.addFrame(192, 128);
				oExplosion.addFrame(0, 192);
				oExplosion.addFrame(64, 192);
				oExplosion.addFrame(128, 192);
				oExplosion.addFrame(192, 192);
				
				var aKeyCodes = {};
				
				jgen.event.add(document.documentElement, 'keydown', function(oEvent) {
					aKeyCodes[oEvent.keyCode] = true;
				});
				
				jgen.event.add(document.documentElement, 'keyup', function(oEvent) {
					aKeyCodes[oEvent.keyCode] = false;
				});
				
				setInterval(function() {
					if (aKeyCodes[32]) if (!window.launched) {
						window.launched = true;
						setTimeout(function() {
								window.launched = false;
						}, 700);
						var aLaunchTo = jgen.math.pointOnCircle(
							oSprite.spriteLeft,
							oSprite.spriteTop,
							oSprite.spriteRotation,
							700
						);
						
						var oMisille = new jgen.sprite(document.body, 'media/missile-sprite.png', 25, 97);
						oMisille.setPosition(
							oSprite.spriteLeft + oSprite.spriteWidth / 2 - oMisille.spriteWidth / 2,
							oSprite.spriteTop + oSprite.spriteHeight / 2 - oMisille.spriteHeight / 2
						);
						oMisille.setRotationBase(jgen.math.deg2rad(90));
						oMisille.setRotation(oSprite.spriteRotation);
						
						oMisille.animateMove(aLaunchTo[0], aLaunchTo[1], function() {
							var oExplosionSprite = oExplosion.clone();
							oExplosionSprite.setPosition(
								oMisille.spriteLeft,
								oMisille.spriteTop
							);
							oExplosionSprite.setVisible(true);
							
							var oMovie = document.createElement('embed');
							oMovie.setAttribute('autostart', true);
							oMovie.style.marginTop = '-100000px';
							oMovie.style.position = 'absolute';
							oMovie.setAttribute('src', 'bomb.wav');
							document.body.appendChild(oMovie);
							setTimeout(function() {
									document.body.removeChild(oMovie);
							}, 1000);
							
							oExplosionSprite.animateFrames(0, 15, function() {
								oExplosionSprite.destroy();
							});
							oMisille.destroy();
						});
						oMisille.setVisible(true);
					}
					if (aKeyCodes[38]) oSprite.moveForward(1);
					if (aKeyCodes[40]) oSprite.moveForward(-1);
					if (aKeyCodes[39]) oSprite.rotate(0.01);
					if (aKeyCodes[37]) oSprite.rotate(-0.01);
				}, 0);
				
				
				
			});
		</script>
	</head>
	<body>
	</body>
</html>
